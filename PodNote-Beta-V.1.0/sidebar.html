<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoteStream Sidebar</title>
  <link rel="stylesheet" href="sidebar.css">
  <!-- Native rich text editor - no external dependencies -->
</head>
<body>
  <div class="sidebar">
    <!-- Header with Video Controls -->
    <div class="header">
      <h1>NoteStream</h1>
      <div class="video-controls">
        <button id="rewind-5s" class="video-control-btn" title="Rewind 5 seconds">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.99 5V1l-5 5 5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6h-2c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
            <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor">5</text>
          </svg>
        </button>
        <button id="play-pause" class="video-control-btn" title="Play/Pause video">
          <svg id="play-pause-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
        <button id="forward-5s" class="video-control-btn" title="Forward 5 seconds">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/>
            <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor">5</text>
          </svg>
        </button>
        <button id="close-button" aria-label="Close sidebar">×</button>
      </div>
    </div>
    
    <!-- Compact Video Info - Single Line -->
    <div class="video-info">
      <div class="video-info-compact">
        📺 <span id="video-title">Loading...</span> • <span id="video-meta">Loading...</span>
      </div>
    </div>
    
    <!-- Enhanced Note Taking Section -->
    <div class="quick-add">
      <!-- Consolidated Timestamp and Video Controls -->
      <div class="compact-controls">
        <span id="capture-time">Capture: --:--</span>
        <div class="control-buttons">
          <button id="quick-rewind-5s" class="quick-control-btn" title="Rewind 5 seconds">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.99 5V1l-5 5 5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6h-2c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
              <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor">5</text>
            </svg>
          </button>
          <button id="quick-play-pause" class="quick-control-btn" title="Play/Pause video">
            <svg id="quick-play-pause-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <button id="quick-forward-5s" class="quick-control-btn" title="Forward 5 seconds">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/>
              <text x="12" y="16" text-anchor="middle" font-size="8" fill="currentColor">5</text>
            </svg>
          </button>
        </div>
        <span class="current-time">Now: <span id="note-timestamp">--:--</span></span>
        <button id="use-current-time" class="time-btn" title="Use current video time (Ctrl/Cmd+T)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </button>
      </div>
      
      <!-- Native Rich Text Editor -->
      <div class="rich-editor-container">
        <div class="rich-toolbar" id="rich-toolbar">
          <button type="button" data-command="bold" title="Bold (Ctrl/Cmd+B)" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/>
            </svg>
          </button>
          <button type="button" data-command="italic" title="Italic (Ctrl/Cmd+I)" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/>
            </svg>
          </button>
          <button type="button" data-command="underline" title="Underline (Ctrl/Cmd+U)" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button type="button" data-command="insertUnorderedList" title="Bullet List" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
            </svg>
          </button>
          <button type="button" data-command="insertOrderedList" title="Numbered List" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
            </svg>
          </button>
          <div class="toolbar-divider"></div>
          <button type="button" data-command="createLink" title="Insert Link" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
            </svg>
          </button>
          <button type="button" data-command="removeFormat" title="Clear Formatting" class="toolbar-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V6H6zm-.27 14.18L17.27 7.73l-1.41-1.41L14.45 7.6 11.82 5h-5.6v1.18L5.05 7.35 3.91 8.49 2.05 6.63.64 8.05l8.28 8.28L7.73 18H10v-1.82l.95-.95L9.77 16.4 5.73 19.18z"/>
            </svg>
          </button>
        </div>
        <div id="rich-editor" contenteditable="true" class="rich-editor" role="textbox" aria-label="Note content">
        </div>
      </div>
      
      <!-- Quick Tag Selection -->
      <div class="quick-tags">
        <div class="tags-row">
          <h5>Quick Tags:</h5>
          <div class="recent-tags" id="recent-tags">
            <!-- Recently used tags appear here -->
          </div>
          <button id="more-tags" class="more-tags-btn">+ More</button>
        </div>
        
        <!-- Tag Suggestions Section -->
        <div class="tag-suggestions" id="tag-suggestions" style="display: none;">
          <h6>Suggested Tags:</h6>
          <div class="suggested-tags-list" id="suggested-tags-list">
            <!-- Suggested tags will appear here -->
          </div>
        </div>
        
        <!-- Save Controls -->
        <div class="save-controls">
          <button id="save-note" class="save-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
            </svg>
            Save Note
          </button>
        </div>
      </div>
      
      <!-- Selected Tags Display -->
      <div class="selected-tags" id="selected-tags">
        <!-- Selected tags appear here -->
      </div>
    </div>
    
    <!-- Enhanced Timeline -->
    <div class="timeline-container">
      <div class="timeline-header">
        <span class="timeline-label">Timeline</span>
        <span class="timeline-count" id="timeline-count">0 notes</span>
      </div>
      <div id="timeline">
        <!-- Timeline markers will be added dynamically -->
      </div>
    </div>
    
    <!-- Notes List Header -->
    <div class="notes-header">
      <h3>Notes <span id="notes-count">(0)</span></h3>
      <div class="notes-controls">
        <button id="filter-button" class="control-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
          </svg>
        </button>
        <button id="export-notes" class="control-btn" title="Export notes">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Notes List -->
    <div id="notes-list">
      <!-- Notes will be added dynamically -->
    </div>
    
    <!-- Tags Dropdown (hidden by default) -->
    <div id="tags-dropdown" class="hidden">
      <div class="tags-container">
        <h4>Select Tags</h4>
        <div id="all-tags-list">
          <!-- All available tags -->
        </div>
        <div class="new-tag-section">
          <input type="text" id="new-tag-input" placeholder="Create new tag...">
          <button id="add-new-tag">Add</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Edit Modal -->
  <div id="edit-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Note</h3>
        <div class="timestamp-editor">
          <label>Timestamp:</label>
          <input type="text" id="edit-timestamp" placeholder="0:00">
          <button id="sync-timestamp" title="Sync with current video time">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4V1l-4 4 4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8z"/>
            </svg>
          </button>
        </div>
        <button class="close-modal">×</button>
      </div>
      <div class="modal-body">
        <div class="rich-editor-container">
          <div class="rich-toolbar" id="edit-rich-toolbar">
            <button type="button" data-command="bold" title="Bold (Ctrl/Cmd+B)" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/>
              </svg>
            </button>
            <button type="button" data-command="italic" title="Italic (Ctrl/Cmd+I)" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/>
              </svg>
            </button>
            <button type="button" data-command="underline" title="Underline (Ctrl/Cmd+U)" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
              </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button type="button" data-command="insertUnorderedList" title="Bullet List" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
              </svg>
            </button>
            <button type="button" data-command="insertOrderedList" title="Numbered List" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
              </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button type="button" data-command="createLink" title="Insert Link" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
              </svg>
            </button>
            <button type="button" data-command="removeFormat" title="Clear Formatting" class="toolbar-btn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 5v.18L8.82 8h2.4l-.72 1.68 2.1 2.1L14.21 8H20V6H6zm-.27 14.18L17.27 7.73l-1.41-1.41L14.45 7.6 11.82 5h-5.6v1.18L5.05 7.35 3.91 8.49 2.05 6.63.64 8.05l8.28 8.28L7.73 18H10v-1.82l.95-.95L9.77 16.4 5.73 19.18z"/>
              </svg>
            </button>
          </div>
          <div id="edit-rich-editor" contenteditable="true" class="rich-editor" role="textbox" aria-label="Edit note content">
            <!-- Rich text editor for editing -->
          </div>
        </div>
        <div class="edit-tags-section">
          <h5>Tags:</h5>
          <div class="edit-tags" id="edit-tags">
            <!-- Editable tags -->
          </div>
          <div class="available-edit-tags" id="available-edit-tags">
            <!-- Available tags for selection -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="delete-note" class="delete-btn">Delete</button>
        <div class="modal-actions">
          <button id="cancel-edit" class="cancel-btn">Cancel</button>
          <button id="save-edit" class="save-btn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Export Modal -->
  <div id="export-modal" class="modal hidden">
    <div class="modal-content export-modal-content">
      <div class="modal-header">
        <h3>📤 Export Notes</h3>
      </div>
      
      <div class="export-controls">
        <div class="selection-summary">
          <span id="selection-count">0 notes selected</span>
          <div class="selection-actions">
            <button id="select-all-notes" class="secondary-btn">Select All</button>
            <button id="deselect-all-notes" class="secondary-btn">Deselect All</button>
          </div>
        </div>
        
        <div class="export-settings">
          <div class="setting-group">
            <label>Format:</label>
            <select id="export-format">
              <option value="markdown">📝 Lesson Plan (Markdown)</option>
              <option value="study-guide">📚 Study Guide</option>
              <option value="text">📄 Plain Text</option>
              <option value="json">💻 JSON Data</option>
              <option value="csv">📊 CSV Spreadsheet</option>
            </select>
          </div>
          
          <div class="setting-checkboxes">
            <label class="checkbox-label">
              <input type="checkbox" id="include-timestamps" checked>
              Include timestamps & video links
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="include-tags" checked>
              Include tags
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="group-by-video" checked>
              Group notes by video
            </label>
          </div>
        </div>
      </div>
      
      <div class="modal-body">
        <div class="export-tabs">
          <button class="tab-btn active" data-tab="selection">📋 Select Notes</button>
          <button class="tab-btn" data-tab="preview">👁️ Preview Export</button>
        </div>
        
        <div class="tab-content">
          <div class="tab-pane active" id="selection-tab">
            <div class="notes-selection">
              <h4>Select Notes to Export:</h4>
              <div class="notes-by-video" id="export-notes-list">
                <!-- Dynamically populated notes -->
              </div>
            </div>
          </div>
          
          <div class="tab-pane" id="preview-tab">
            <div class="export-preview">
              <h4>Export Preview:</h4>
              <div class="preview-container">
                <pre id="export-preview-content">Select notes and choose export options to see preview...</pre>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="cancel-export" class="cancel-btn">Cancel</button>
        <button id="confirm-export" class="primary-btn" disabled>
          Export Selected Notes
        </button>
      </div>
    </div>
  </div>
  
  <!-- Templates -->
  <template id="note-template">
    <div class="note-item">
      <div class="note-header">
        <div class="note-timestamp"></div>
        <button class="edit-note-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </button>
      </div>
      <div class="note-content"></div>
      <div class="note-tags"></div>
    </div>
  </template>
  
  <script src="sidebar.js"></script>
</body>
</html>
